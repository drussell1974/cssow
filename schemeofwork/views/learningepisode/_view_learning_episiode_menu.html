{{ from helper_string import dictionary_to_string }}
<div id="accordion">
  {{
    topic_name = ""
    first_item = True
  }}
  {{ for item in view_model: }}
    {{ if item.topic_name != topic_name: }}
      {{ if first_item == False: }}
          </div><!-- class="card-body" -->
        </div><!-- id="collapseX" class="collapse show" -->
       </div><!--  class="card" -->
      {{ pass }}
      <div class="card">
        <div class="card-header" id="topic-{{=item.topic_id}}-heading">
          <h5 class="mb-0">
            <a id="topic-{{=item.topic_id}}-heading-text" class="nav-link" data-toggle="collapse" data-target="#topic-{{=item.topic_id}}-collapse" aria-expanded="true" aria-controls="topic-{{=item.topic_id}}-collapse">
              {{ =item.topic_name}}
            </a> <!-- class="btn btn-link" -->
          </h5><!-- class="mb-0" -->
        </div><!-- class="card-header" -->
      <div id="topic-{{=item.topic_id}}-collapse" class="collapse {{ if topic_id == item.topic_id: }}show{{ pass }}" aria-labelledby="topic-{{=item.topic_id}}-heading" data-parent="#accordion">
        <div class="card-body">
        {{
          topic_name = item.topic_name
          first_item = False
         }}
    {{ pass }}

            <div class="{{ if item.id == learning_episode_id: }}mark{{pass}} fillspace">
              <a href="{{=URL('learningobjective', 'index', args=[item.scheme_of_work_id, item.id])}}" class="nav-link" id="nav-link-learning-episode-{{=learning_episode_id}}">
                {{=T("Week {}: {}").format(item.order_of_delivery_id, dictionary_to_string(item.related_topic_ids,"name", {"checked":True}))}}
              </a>
            </div>
  {{ pass }}
</div>
