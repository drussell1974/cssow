{% extends 'default/__layout.onecolumn.html' %}

{% block breadcrumb %}
<nav class="navbar navbar-expand-lg navbar-light" id="itemNav">
  <div class="container">
      <ul class="navbar-nav ml-auto">
        <li class="nav-item">
          <a class="nav-link" id="btn-bc-schemes_of_work" href="{% url 'schemesofwork.index' %}">
            {{_("Schemes of Work")}}
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" id="btn-bc-lessons" href="{% url 'lesson.index' content.data.scheme_of_work_id %}">
            {{_("Lessons")}}
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" id="btn-bc-learning_objectives" href="{% url 'learningobjective.index' content.data.scheme_of_work_id content.data.lesson_id %}">
            {{_("Objectives")}}
          </a>
        </li>
      </ul>
  </div>
</nav>
{% endblock %}


{% block contentheading %}
  <div class="alert alert-secondary">
    {% if content.data.lesson.is_copy %}
    <i class="btn btn-danger float-right" id="copy-of-{{content.data.lesson.orig_id}}">{{_("Copy")}}</i>
    {% endif %}
    <h5 class="secondary-heading">{{ content.main_heading }} {{ content.sub_heading }}</h5>
    {% if content.strap_line is not None %}
      <p class="lead">{{ content.strap_line }}</p>
    {% endif %}
  </div>
{% endblock %}


{% block maincontent %}
<form name="edit-lesson" id="form" method="post" action="{% url 'lesson.save' content.data.scheme_of_work_id content.data.lesson_id %}">
    {% csrf_token %}
    <div class="control-group">
      <div class="form-group  controls">
        <label>{{_("Year group")}}</label>
        <select class="form-control" name="year_id" id="ctl-year_id" required>
            <option value="" {% if has_objectives == True %} disabled {% endif %}>- {{_("Select an option")}} -</option>
            {% for opt in content.data.year_options %}
            <option value="{{opt.id}}" {% if opt.id == content.data.lesson.year_id %} selected {% endif %}>{{opt.name}}</option>
            {% endfor %}
        </select>
        <p class="help-block text-danger"></p>
      </div>
    </div>
    <div class="control-group">
      <div class="form-group  controls">
        <label>{{_("Order of delivery")}}</label>
        <!-- in the future select from planner -->
        <input type="number" name="order_of_delivery_id" class="form-control" placeholder="{{_('Enter an order of delivery')}}" id="ctl-order_of_delivery_id" required
               min="1" max="9999" value='{{content.data.lesson.order_of_delivery_id}}'>
        <p class="help-block text-danger"></p>
      </div>
        <hr>
    </div>
    <div class="control-group">
      <div class="form-group  controls">
        <label>{{_("Title")}}</label>
        <input type="text" name="title" class="form-control" placeholder="{{_('Enter a title')}}" id="ctl-title" required
               maxlength="45" value='{{content.data.lesson.title}}'>
        <p class="help-block text-danger"></p>
      </div>
        <hr>
    </div>
    <div class="control-group">
      <div class="form-group  controls">
        <label>{{_("Summary")}}</label>
        <input type="text" name="summary" class="form-control" placeholder="{{_('Enter a summary')}} {{_('(optional)')}}" id="ctl-summary"
               maxlength="80" value='{{content.data.lesson.summary}}'>
        <p class="help-block text-danger"></p>
      </div>
        <hr>
    </div>
    <div class="control-group">
      <div class="form-group  controls">
        <label>{{_("Topic")}}</label>
        <select class="form-control" name="topic_id" id="ctl-topic_id" required>
            <option value="" {% if has_objectives == True %} disabled {% endif %}>- {{_("Select an option")}} -</option>
            {% for opt in content.data.topic_options %}
            <option value="{{opt.id}}" {% if opt.id == content.data.lesson.topic_id %} selected {% elif has_objectives == True %} disabled {% endif %}>{{opt.name}}</option>
            {% endfor %}
        </select>
        <p class="help-block text-danger"></p>
      </div>
    </div>
     <div class="control-group">
      <div class="form-group controls">
        <div id="div-related_topic_id">
        </div>
        <p class="help-block text-danger"></p>
      </div>
    </div>
    {% if content.data.show_ks123_pathway_selection %}
      <!-- KS123 Pathway START - SHOW FOR LESS THAN YEAR 10 -->
      <div class="control-group">
        <div class="form-group controls">
          <label>{{_("Linked to pathway")}} {{content.data.lesson.pathway_ks123_ids}}</label>
          <select multiple type="text" name="pathway_ks123_ids" class="form-control" id="ctl-pathway_ks123"
               maxlength="250">
          {% for pathway in content.data.ks123_pathways %}
            {% if pathway.id in content.data.lesson.pathway_ks123_ids %}
              <option value="{{pathway.id}}" selected >{{pathway.objective}}</option>
            {% else %}    
              <option value="{{pathway.id}}" >{{pathway.objective}}</option>
            {% endif %}
          {% endfor %}
        </select>  
          <div id="div-pathway_ks123_id">
            </div>
            <span class="small mark"><a href="http://community.computingatschool.org.uk/resources/1692/single">CAS Computing progression pathways</a> co-author <a href="https://www.markdorling.net/">Mark Dorling</a></span>
            <p class="help-block text-danger"></p>
        </div>
      </div>
      <!-- KS123 Pathway END -->
      {% endif %}
    <div class="control-group">
      <div class="form-group  controls">
        <label>{{_("Keywords")}}</label>
        <input type="hidden" class="form-control" id="tags" />
        <input type="text" name="key_words_str" class="form-control" id="keywords-tokenfield"  value='{{content.data.lesson.key_words_str}}' />
        <p class="help-block text-danger" id="token-error"></p>
      </div>
        <div id="keywords"></div>
        <hr>
    </div>
      <!-- Pathway Objectives START -->
      <div class="control-group">
        <div class="form-group controls">
          <label>{{_("Prior learning")}}</label>
            <div id="div-pathway_objective_id">
              <select id="ctl-pathway_objective_id" multiple></select>
            </div>
            <p class="help-block text-danger"></p>
        </div>
      </div>
    <br>
    <div id="success"></div>
    <div class="form-group">

      <button type="submit" name="published" value="2" class="btn btn-secondary" id="btn-delete">{{_("Delete")}}</button>
      <button type="submit" name="published" value="0" class="btn btn-primary" id="draftButton">{{_("Draft")}}</button>
      <button type="submit" name="published" value="1" class="btn btn-primary" id="saveButton">{{_("Save and Publish")}}</button>
      <!-- Hidden Fields -->
      <input type="hidden" name="id" value="{{content.data.lesson.id}}" id="hdn-lesson_id">
      <input type="hidden" name="orig_id" value="{{content.data.lesson.orig_id}}">
      <input type="hidden" name="scheme_of_work_id" value="{{content.data.scheme_of_work_id}}">
      <input type="hidden" name="key_stage_id" value="{{content.data.lesson.key_stage_id}}" id="hdn-key_stage_id">
      <input type="hidden" name="related_topic_ids" value="{{ content.data.lesson.related_top }} {{ ic_ids }}" id="hdn-related_topic_ids">
      <input type="hidden" name="key_words" id="hdn-key_words" />
      <input type="hidden" name="next" value="{% url 'lesson.index' content.data.scheme_of_work_id %}" > 
      <input type="hidden" name="get_key_words_uri" value="{% url 'api.default.keywords' %}" id="hdn-keywords_uri"><!-- get_key_words  -->
      <button type="cancel" class="btn btn-primary" id="cancelButton">{{_("Cancel")}}</button>
    </div>
  </form><!-- form#form -->
{% endblock %}

{% block head_css %} 
  {% load static %}
  <link href="{% static 'default/vendor/sliptree/css/bootstrap-tokenfield.min.css' %}" rel="stylesheet">
  <link href="{% static 'default/vendor/sliptree/css/tokenfield-typeahead.min.css' %}" rel="stylesheet">
{% endblock %}

{% block page_js %}
    {% load static %}
    <script type="text/javascript" src="//code.jquery.com/jquery-1.9.1.js"></script>
    <script type="text/javascript" src="//code.jquery.com/ui/1.10.3/jquery-ui.js"></script>
    <script type="text/javascript" src="{% static 'default/vendor/sliptree/js/bootstrap-tokenfield.min.js' %}"></script>
    <script type="text/javascript" src="{% static 'default/js/keyword-tokens.js' %}"></script>"
  <script>
      init_keyword_tokens(
        document.getElementById('hdn-keywords_uri').value // get_keywords_url
        , "#keywords-tokenfield" // token_input_css_selector
        , ".tokenfield .token .token-label" //all_tokens_css_selector
        , "#hdn-key_words" //form_field_selector
        , "#token-error" //error_css_selector
      )
    </script>
{% endblock %}

